var Config = require('./config');
var nuby_strata = require('./../../lib');
var strata = require('./../../node_modules/strata');

module.exports = function (callback) {
    var config = new Config(__dirname);

    function _on_app(err, app) {
        if (err) return callback(err);

        callback(err, app);
    }

    var context = nuby_strata.context.create(config);

    var app = new strata.Builder();
    app.use(strata.contentType, 'text/plain');
    app.use(strata.contentLength);

    nuby_strata.load_apps(config.app_path, _on_app, context, app);
};