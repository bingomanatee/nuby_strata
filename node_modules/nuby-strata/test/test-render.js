var nuby_strata = require('./../lib');
var env;
var page_template_path;
var layout_template_path;
var path = require('path');
var util = require('util');

module.exports = {
    setup:function (test) {
        env = {
            _render_params:{
                title:'My Title',
                body:'page body',
                page_title:'my_page',
                page_content:'this is my page content'
            }
        }

        page_template_path = path.resolve(__dirname, './../test_resources/templates/page.html');
        layout_template_path = path.resolve(__dirname, './../test_resources/templates/layout.html');

        test.done();
    },

    test_action_render:function (test) {

        nuby_strata.render.render_action(page_template_path, env, function (err, out) {
            var page_content = util.format('<h1>%s</h1><p>%s</p>', env._render_params.title, env._render_params.body);
            test.equal(out, page_content, 'page content does not match ' + page_content);
            test.done();
        }, {});
    },

    test_layout_render:function (test) {

        nuby_strata.render.render_layout(layout_template_path, env, env._render_params.page_content, function (err, out) {
            var layout_content = util.format('<html><head><title>%s</title></head><body>%s</body></html>', env._render_params.page_title, env._render_params.page_content);
           // console.log('out: %s, layout_content: %s', out, layout_content);
            test.equal(out, layout_content, 'page content does not match ' + layout_content);
            test.done();
        }, {});

    }
}

