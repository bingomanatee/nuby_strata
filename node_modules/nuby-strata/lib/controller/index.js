var path = require('path');
var st_path = path.resolve(__dirname, './../../node_modules/strata');
//console.log('st_path: %s', st_path);
var strata = require(st_path);
var _ = require('./../../node_modules/underscore');
var util = require('util');

/**
 * Controller is a stock template for handling action related actions.
 * @param config
 */

function Controller(config) {
    _.extend(this, config);

    if (this._layout_path && (!this.layout)) {
        module.exports.add_layout(this);
    }
}

Controller.prototype = {

    render:function (env, view_path, callback) {
        var ns_path = path.resolve(__dirname, './../..');
        var nuby_strata = require(ns_path);
        return nuby_strata.render(view_path, env, callback, this);
    },

    error:function (params, callback) {
        strata.redirect.forward(params.env, callback, '/');
    },

    can:function (task, env, if_can, if_block) {
        if_can(env);
    },

    actions:{}

}


module.exports = {
    Controller:Controller,
    create:function (controller_path, context) {
        if (!config) {
            config = {};
        }

        var controller = new Controller(context);

        return controller;

    },

    add_layout:function (action) {
        action.layout = module.exports._layout;
    },

    _layout:function (env, body, callback) {
        env._action = this;
        this.context.layout(env, this._layout_path, body, callback);
    },

}
