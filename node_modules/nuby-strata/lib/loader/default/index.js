var fs = require('fs');
var path = require('path');
var _ = require('underscore');
var util = require('util');
/**
 * DEFAULT LOADER: handles a basic path handler.
 */
module.exports = {

    load:function (app_path, callback, config, app) {
        var app_info = require(app_path);

      //  console.log('default_loader::load: app_path %s', util.inspect(app_path, false, 1));
      //  console.log('default_loader::load: callback %s', util.inspect(callback, false, 1));
      //  console.log('default_loader::load: app %s', util.inspect(app, false, 1));
       // console.log('default_loader::load: app_info %s', util.inspect(app_info, false, 1));


        var app_config = {
            app_info:app_info,
            path:app_path,
            config:config
        }

        var name = app_info.name;
        var action_path = app_path + '/actions/default';

        if (!path.existsSync(action_path)){
            throw new Error(util.format('%s: cannot find action path %s', __dirname, action_path));
        }
        var action = require(action_path);
      //  console.log('found action %s', util.inspect(action, false, 0));

        if (!(action.handle && (typeof action.handle == 'function'))) {
            throw new Error(util.format('%s: action %s has no function "handle"', __dirname, app_path));
        }
        var route = '/' + name;

      //  console.log('default_loader::load: default route added to path %s', route);
        app.route(route, action.handle(app_config), ['GET']);
      //  console.log('calling callback', callback.toString());
        callback();

    },

    scaffolding:{
        'default':require('./scaffolding/default')
    }
}