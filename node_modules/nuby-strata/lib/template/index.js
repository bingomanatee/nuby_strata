var underscore = require('./../../node_modules/underscore');

function Template(template_path) {
    this.template_path = template_path;
    var config = require(template_path);
    _.extend(this, config);
    if (!this.prefix) {
        throw new Error('template files must have prefix property ' + template_path);
    }
}

Template.prototype = {
    init:function (context, callback) {
        var nuby_strata = require(__dirname);
        context.static_resources.push(
            nuby_strata.loader.create_resource(this.template_path, this.prefix));

        callback(null, this);
    },

    layout_path: function(){
        return this.template_path + '/template.html';
    },

    /**
     *
     * @param env: Object:: request context
     * @param body: String the custom page content
     * @param callback: function
     * @param action: Action NOT really needed - its in env; useful for re-contextualizing
     */
    render:function (env, body, callback, action) {

        if (!action){
            action = env._action;
        }

        //@TODO: hooks for panels etc.

        context.layout(this.layout_path(), env, body, callback, action);
    }

}


module.exports = Template;