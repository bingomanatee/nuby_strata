var Base_Action = require('./base');
var _ = require('./../../../node_modules/underscore');
var util = require('util');
var strata = require('./../../../node_modules/strata');

function Put_Action(config) {
    //  console.log('action on creation: %s', util.inspect(this));
    _.extend(this, config);
    this._init(this);
}

Put_Action.prototype = _.clone(Base_Action.prototype);

Put_Action.prototype.data_do = function (env, on_data_callback) {
    var action = this;

    if (env._request_params.hasOwnProperty(action.rest_name())) {
        var new_item = env._request_params[action.rest_name()];
        action.insert(env, new_item, on_data_callback);
    } else {
        return on_data_callback(new Error('no content'));
    }

}

Put_Action.prototype.insert = function(env, new_item, on_data_callback){
    console.log('inserting new data: %s', util.inspect(new_item));
    this.controller.model.insert(new_item, on_data_callback);
}

module.exports = {
    Put_Action:Put_Action,
    create:function (controller, config, action_path, context) {

        if (!config) {
            config = {type:'default'};
        }

        config.controller = controller;
        config.context = context ? context : controller.context;
        config.path = action_path;

        var action = new module.exports.Put_Action(config);

        return action;

    }
}