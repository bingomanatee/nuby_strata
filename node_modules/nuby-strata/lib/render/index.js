var ejs = require('./../../node_modules/ejs');
var fs = require('fs');
var util = require('util');
var path = require('path');

module.exports = {

    render_action:function (view_path, callback,  env, action) {
        console.log('render_action(%s, %s, %s, %s)', view_path, util.inspect(env, false, 0), util.inspect(callback), util.inspect(action, false, 0));
        if (!path.existsSync(view_path)) {
            throw new Error(util.format('%s: Cannot find view_path %s', __dirname, view_path));
        }
        if (typeof (callback) != 'function') {
            throw new Error(util.format('%s: callback is not a function; %s', __dirname, typeof (callback)))
        }
        //   console.log('ns-render:: path %s, params: %s', path, util.inspect(path));

        fs.readFile(view_path, function (err, data) {
            //   console.log('ns-render:: data %s', data.toString());
            callback(null, ejs.render(data.toString(), {locals:env._render_params}));
        });
    },

    render_layout: function(layout_path, env, body, callback, action) {
        if (!path.existsSync(layout_path)) {
            throw new Error(util.format('%s: Cannot find layout_path %s', __dirname, layout_path));
        }
        if (typeof (callback) != 'function') {
            throw new Error(util.format('%s: callback is not a function', __dirname))
        }
        //   console.log('ns-render:: path %s, params: %s', path, util.inspect(path));
        if (env._render_params){
            env._render_params.content = body;
        } else {
            env._render_params = {_content: body};
        }

        fs.readFile(layout_path, function (err, data) {
            //   console.log('ns-render:: data %s', data.toString());
            callback(null, ejs.render(data.toString(), {locals:env._render_params}));
        });
    }

}
