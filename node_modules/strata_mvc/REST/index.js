var fs   = require('fs');
var path = require('path');
var _    = require('underscore');

exports = function(app_path, config, app, app_info){
    if (!app_info){
        app_info = require(app_path);
    }

    var app_config = {
        module: app_info,
        path: app_path,
        config: config
    }

    var name = app_mod.name;

    var get_path = app_path + '/actions/get';
    if (path.existsSync(get_path )){
        var action = require(get_path);
        app.get('/' + name + '/:id',         action.handle());
        app.get('/' + name + '/:id.:format', action.handle(app_config, 'format'));
    }

    var list_path = app_path + '/actions/list';
    if (path.existsSync(list_path )){
        var action = require(list_path);
        app.get('/' + name,              action.handle(app_config, 'format'));
        app.get('/' + name + '.:format', action.handle(app_config, 'format'));
    }

    var new_path = app_path + '/actions/new';
    if (path.existsSync(new_path )){
        var action = require(new_path);
        app.get('/' + name + '/new',      action.handle(app_config, 'form'));
        app.post('/' + name,              action.handle(app_config));
        app.post('/' + name + '.:format', action.handle(app_config, 'format'));
    }

    var edit_path = app_path + '/actions/edit';
    if (path.existsSync(edit_path )){
        var action = require(edit_path);
        app.get('/' + name + '/:id/edit',     action.handle(app_config, 'form'));
        app.put('/' + name + '/:id',          action.handle(app_config));
        app.post('/' + name + '/:id/update',  action.handle(app_config));
        app.post('/' + name + '/:id.:format', action.handle(app_config, 'format'));
    }

    var del_path = app_path + '/actions/del';
    if (path.existsSync(del_path )){
        var action = require(del_path);
        app.del('/' + name + '/:id',         action.handle(app_config));
        app.get('/' + name + '/:id/delete',  action.handle(app_config, 'form'));
        app.post('/' + name + '/:id/delete', action.handle(app_config));
    }

}