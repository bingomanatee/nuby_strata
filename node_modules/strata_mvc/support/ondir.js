var fs = require('fs');
var path = require('path');
var util = require('util');

/**
 * executes across all files/dirs in a directory - non recursive.
 *
 * @param root_path  :string - an absolute directory path
 * @param if_file:   :function - executes on all files. Passed full path to file.
 * @param if_dir:    :function - executes on all directories. Passed full path to file.
 * @param if_nopath  :function - executes if root path does not exist; otherwise error thrown.
 */
module.exports = function(root_path, if_file, if_dir, if_nopath) {
    root_path = root_path.replace(/\/$/, '');
    if (!path.existsSync(root_path)) {

        if (if_nopath) {
            if_nopath(root_path);
        } else {
            throw new Error(util.format('%s: cannot find path "%s"', __dirname, app_path));
        }
    } else {

        var items = fs.readdirSync(root_path);

        items.forEach(function(item) {
            var root = root_path + '/' + item;
            var s = fs.statSync(root);
            if (s.isDirectory() && if_dir) {
                if_dir(root);
            } else if (s.isFile()){
                if_file(root);
            }
        })
    }

}