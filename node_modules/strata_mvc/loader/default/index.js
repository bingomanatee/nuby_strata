var fs   = require('fs');
var path = require('path');
var _    = require('underscore');
var util = require('util');

module.exports = function(app_path, config, app, app_info){
    if (!app_info){
        app_info = require(app_path);
    }

    var app_config = {
        module: app_info,
        path: app_path,
        config: config
    }

    var name = app_info.name;
    var action = require(app_path);

    if (!(action.handle && (typeof action.handle == 'function'))){
        throw new Error(util.format('%s has no function "handle"', app_path));
    }
    app.route('/' + name, action.handle(app_config), ['ALL']);

}