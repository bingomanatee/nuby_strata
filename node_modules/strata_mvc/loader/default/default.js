var strata = require('strata');

module.exports = {
    handle: function(config, type) {

        var action = require(config.path);

        return function(env, callback) {

            function _on_params(err, params) {
                if (err && strata.handleError(err, env, callback)) {
                    return;
                }

                var data = action.data(env);

                if (type == 'format') {
                    var format = env.route.format;
                    if (format == 'json') {
                        callback(200, {}, JSON.stringify(data));
                    } else {
                        redirect.forward(env, callback, '/');
                    }
                } else {
                    callback(200, {}, action.render(data));
                }

            }

            var req = strata.Request(env);
            req.params(_on_params);
        }
        
    }
}